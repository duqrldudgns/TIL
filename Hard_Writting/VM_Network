NAT
10.0.2.15 
이 패킷이 NAT라는것ㅇㄹ 통해 HOST의 랜카드를 통해 나가는 구조
HOST에서도 못들어옴
cmd
핑 10.0.2.15 해도안됨
NAT로 보호되고있기 때문에 근데 그전에 안되는 이유가 있음
> route print
기본게이트웨이 0.0.0.0 아무것도 모를때 192.168.0.1게이트웨이로 가라
​
10.0.0.0 대역이 없음
10점대역으로 가라고 하더라도 라우팅테이블에없기때문에 찾아갈수없음
​
sudo apt install nginx
sudo apt install curl
​
curl localhost 내부에서만 볼수 있음
홈피에서 localhost 하면 보임
​
바깥에서 하기위해서 포트포워딩
설정에서 포트포워딩
나는 웹서버야 호스트80으로오면 게스트 80으로 보내줘 설정
10.0.2.15 해도안됨 이유 - 호스트는 10.0 이게아니라 로컬호스트인거잖아요 ​그래서
localhost 해야됨
​
이번에는 호스트1234로하면
localost:1234해야댐
나한테온거를 호스트포트번호를 저 게스트로 보내줘~
​
인터페이스가하나밖에없음
-두번째어댑터로가서 호스트전용어댑터
​
호스트관리자가면 어댑터하나있음 192.168.56.1 여기에붙는 디바이스한테 이 아이피를할당해줘
새로생긴 인터페이스는 호스트와연결되어있음
​
win cmd 에서 192로핑 하면 됨
ubuntu에서 ping 하면 안됨 (방화벽 풀면 됨)
​
win에서 192.168.하면 잘 됨
앞서 NAT를통해 외부와 연결이 잘 되게끔설정해줬기때문에 호스트전용어댑터여도 통신됨
​
내부 네트워크 
세번째 어댑터 가서 내부네트워크
두번째우분투 1NAT비활성화 3번째어댑터 내부네트워크
​
1 sudo ifconfig enp0s9 10.10.10.1/24
2 sudo ifconfig enp0s9 10.10.10.10/24
2ping 10.10.10.1 하면 됨
ping 8.8.8.8(켜놓기)하면안됨 외부통신 x
route -n 해보면 기본 게이트웨이가없음
dhcp로 할당받지못했기때문
10점대역대말고는 아무데도 갈수없는애
but
10.1을통해 외부와연결가능
10.10.10.1하면 nginx 뜸
외부통신 하고싶으면 
내가 모르는 대역에 대해서 밖으로나갈수있는 디폴트 게이트웨이가필요
​
1.에는 route -n 해보면
모르는 게있으면 나갈수있는 디폴트게이트웨이가있음
0.0.0.0 ----------- << 이거
​
2 sudo ip route add default via 10.10.10.1
​​디폴트게이트웨이생김
ping8.8.8.8하면 가기는감 돌아오진못함
​
1.sudo tcpdump -i enp0s9 -nne
2의 리퀘스트가 들어오고있음
1sudo tcpdump -i enp0s3 -nn host 8.8.8.8 (켜놓기)​나가는패킷은업슴
터미널창하나더띄워서​
1.sudo tcpdump -i enp0s9 -nn host 8.8.8.8 (켜놓기)​ 8.8.8.8로가고있는패킷을 얘가 9에서 받아왔는데 3으로 안보내주고있음 라우트가아니라 피씨임. 그렇기때문에.일일이설정해줘야함 이 운영체제를 라우터로만들면되는것
​
1.sysctl -a | grep ip_forward ip포워가원래비활성화되있는데
1 sudo sysctl -w net.ipv4.ip_forward=1 바꾸는순간 들어온게바깥으로나감
나가는건성공.들어오는건아직
why? 10.10.10.10을 들고 나감
2점대역은아는데 10점대역은모르기에 못들어옴
그래서우분투자체를 nat라우터로만들어줘야함
nat라는 테이블을 통해서
1. sudo iptables -t nat -A POSTROUTING -o enp0s3 -j MASQUERADE
nat라우터로 바꾸는 순간 2에들어옴
10으로나가던애가 2로 나감
내 ip를달고나가야 들어와짐
​
sudo tcpdump -i enp0s3 -nn port 80 을 보고
sudo tcpdump -i enp0s9 -nn port 80​
2에서 웹브라우저 열면 통신하는게 보임
라우터역할을함
이것이 방화벽을 개발하는것이됨
sudo iptables -A FORWARD -d 8.8.8.8 -j DROP  /  8.8.8.8로가는걸 드랍하고싶 , 하면 막힘
sudo iptables -D FORWARD -d 8.8.8.8 -j DROP  지우면 패킷다시왔다갔다함
​
대량의 icmp 공격을하고싶다고 할때
1.sudo tcpdump -i enp0s9 -nne icmp
2.ping  -f 10.10.10.1
​
​
2의2어뎁터에 호스트전용어댑터추가
​
3의 1NAT 2내부네트워크추가
​
2에서 호스트가생겨서 원치않게 1의 192와 통신가능
​
mnap을돌려 호스트내부에있는 걸스캔하려는걸보여줄려고함
2. 10.10.10.20으로설정
1. nmap 10.10.10.0/24
nmap -O 10.10.10.0/24  뭐 자세한 정보 알아오는옵션
